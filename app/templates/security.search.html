{% extends "layout.html" %} {% block title %}Securities{% endblock %} {% block content %}
<h1>Securities</h1>

<div class="card bg-matte text-light">
    <div class="card-body">
        <form id="searchForm" name="searchForm">
            <div class="form-group">
                <label for="search.symbol">Select security</label>
                <div class="text-dark">
                    <select id="search_symbol" name="search.symbol" class="form-control chosen">
                        {% for security in model.securities %} {% set name = model.securities[symbol] %}
                        <option {% if security.mnemonic == filter.symbol %}selected{% endif %} 
                            value="{{ security.namespace }}:{{ security.mnemonic }}">
                            {{ security.mnemonic }} - {{ security.fullname }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
            </div>

            <div class="text-center">
                <button type="button" id="select" class="btn btn-primary">Select</button>
            </div>

        </form>
    </div>
</div>

{# Results #}
<div id="results" class="mt-3"></div>

{% endblock %} {% block scripts %}
<script type="text/javascript">
    $(function () {
        var getDetailsUrl = function(symbol) {
            return '/security/details/partial/' + symbol;
        };

        var navigate = function(symbol) {
            window.location = getDetailsUrl(symbol);
        };

        var loadPage = function(symbol) {
            var url = getDetailsUrl(symbol);
            $.ajax({
                url: url,
                success: function(data, textStatus, jqXHR) {
                    $("#results").html(data);
                }
            });
        };

        $("#search_symbol").chosen().change(function(event) {
            symbol = $(this).chosen().val();
            //navigate(symbol);
            loadPage(symbol);
        });

        $("#select").click(function () {
            var symbol = $("#search_symbol").chosen().val();
            //navigate(symbol);
            loadPage(symbol);
        });

    });
</script> {% endblock %}